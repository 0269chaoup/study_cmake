# 第 004 讲：CMake 变量之普通变量

- [第 004 讲：CMake 变量之普通变量](#第-004-讲cmake-变量之普通变量)

通过第一部分的学习，我们已经能在简单的项目中使用 CMake 了。但是到了复杂的项目中，光靠第一部分那一点点知识是完全不行的。所以从这一部分开始，我们将全面系统地学习 CMake 的基础知识，为在大型项目中使用 CMake 能游刃有余打下坚实的基础。

和任何其他编程语言一样，CMake 完全可以看做是一种编程语言，他有变量，有函数等。本讲我们主要学习 CMake 的变量，但是 CMake 变量是 CMake 的基础，也是很重要的一部分知识，一节课是很难讲清楚的，我们会分为很多讲来学习 CMake 变量的知识。

CMake 定义变量的命令如下：
```cmake
set(varName value... [PARENT_SCOPE])
```

在学习这个命令的具体含义之前，我先讲几点 CMake 变量的约定：
- CMake 将所有的变量的值视为字符串
- 当给出变量的值不包含空格的时候，可以不使用引号，但建议都加上引号，不然一些奇怪的问题很难调试。
- CMake 使用空格或者分号作为字符串的分隔符
- CMake 中想要获取变量的值，和 shell 脚本一样，采用 ```${var}``` 形式。
- 使用 CMake 变量前，不需要这个变量已经定义了，如果使用了未定义的变量，那么它的值是一个空字符串。
  - 默认情况下使用未定义的变量不会有警告信息，但是可以通过 cmake 的 -warn-uninitialized 选项启用警告信息。
  - 使用未定义的变量非常常见，如果出现问题也不一定是因为变量未定义导致的，所以 cmake 的 -warn-uninitialized 选项用处很有限。
- 变量的值可以包含换行，也可以包含引号，不过需要转义。

好了，知道了上述约定，现在我们一起来学习 ```set(varName value... [PARENT_SCOPE])``` 具体怎么使用。

第一个参数是必须的，代表要定义的变量的变量名。

第二个参数也是必须的，代表要定义的变量的值，根据上述 CMake 变量的约定，我们知道这里的 value 应该是一个字符串，而且不管有没有空格，都建议用引号引起来。

当然第二个参数可以是一个以空格或者分号隔开的字符串，这样定义的变量将是一个列表，对于列表我们后面会详细讲，这里大家可以忽略。在学习列表之前，大家只需要记住，value 只使用没有空格或者分号分割的单个字符串即可。

第三个参数是一个可选参数，意思是定义的这个变量的作用域属于父作用域，关于作用域我们后面也会详细讲解，本讲大家不要使用这个可选参数即可。

下面我们来看一些例子，加深一下对 ```set(varName value... [PARENT_SCOPE])``` 的理解。

```cmake
set(CPR_TOP_DIR "/root/workspace/code/cpr")

set(CPR_BASE_SOURCE "a.cpp;b.cpp")

set(CPR_CORE_SOURCE core1.cpp core2.cpp)

set(CPR_BUILD_CMD [[
#!/bin/bash

cmake -S . -B build
cmake --build build
]])

set(shellScript [=[
#!/bin/bash
[[ -n "${USER}" ]] && echo "Have USER"
]=])
```

既然有定义变量的方式，那取消变量定义应该怎么做呢？

```cmake
set(myVar)
unset(myVar)
```

本讲主要讲解了 CMake 定义变量最基本的用法，我称这种变量为基础变量。后续课程还会学习环境变量、缓存变量、变量作用域等知识，敬请期待。

欢迎有条件的朋友加入我的知识星球，知识星球将提供更好的答疑服务。
<img src="./picture/zhishixingqiu.jpeg" width="100%" height="100%">