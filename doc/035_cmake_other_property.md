# 第 035 讲：CMake 其他属性

由于 CMake 缓存变量属性与单元测试属性内容比较少，本讲就一起介绍，顺便对 CMake 属性做一个总结。

## CMake 缓存变量属性

CMake 缓存变量是用于存储用户定义的变量，可以在多次构建过程中保持不变的一种变量。CMake 的缓存变量属性是针对缓存变量的属性，主要是为了影响 CMake GUI 和 ccmake 工具的使用体验，而不会直接影响构建过程。下面将详细介绍 CMake 缓存变量属性的相关信息：

- 变量类型（TYPE）
  - 每个缓存变量都有一个类型，类型必须是 BOOL、FILEPATH、PATH、STRING 或 INTERNAL 中的一种。使用 get_property() 命令和属性名 TYPE 可以获取变量的类型。变量的类型会影响 CMake GUI 和 ccmake 工具中的变量呈现方式以及用于编辑其值的小部件。类型为 INTERNAL 的变量将不会在 GUI 中显示。

- 高级变量（ADVANCED）
  - 使用 mark_as_advanced() 命令可以将缓存变量标记为高级变量。实际上，这只是设置布尔类型的 ADVANCED 缓存变量属性。CMake GUI 和 ccmake 工具都提供了一个选项，用于显示或隐藏高级缓存变量。用户可以选择关注基本变量还是查看完整列表。

- 帮助字符串（HELPSTRING）
  - 缓存变量的帮助字符串通常作为 set() 命令的一部分进行设置，但也可以使用 HELPSTRING 缓存变量属性进行修改或读取。帮助字符串用作 CMake GUI 中的工具提示以及 ccmake 工具中的单行帮助提示。

- 变量值列表（STRINGS）
  - 如果缓存变量的类型是 STRING，则 CMake GUI 将查找名为 STRINGS 的缓存变量属性。如果不为空，则该属性应为该变量的有效值列表，并且 CMake GUI 将以该列表中的值作为下拉列表框而不是任意文本输入小部件呈现该变量。在 ccmake 中，按下该缓存变量上的 enter 键将循环显示所提供的值。注意，CMake 并不强制缓存变量必须是 STRINGS 属性中的值，这只是为了方便 CMake GUI 和 ccmake 工具使用。

总之，CMake 缓存变量属性是为了影响 CMake GUI 和 ccmake 工具的使用体验而设置的属性。它们不会直接影响构建过程，而是为了让用户更方便地使用 CMake。

## CMake 单元测试属性

CMake 为单元测试提供了简化版本的设置和获取属性的命令，如下：

```cmake
set_tests_properties(test1 [test2...]
    PROPERTIES
        propertyName1 value1
        [propertyName2 value2] ...
)
get_test_property(resultVar test propertyName)
```

签名和 CMake target 属性类似，使用方法也类似，这里就不赘述了。

属性是 CMake 的关键部分。许多命令都有能力设置、修改或查询各种类型的属性，其中一些对项目之间的依赖关系有进一步的影响。

一般情况下，使用通用的 ```set_property()``` 命令可以完全操作除了特殊的全局伪属性以外的所有属性，这使得开发人员能够预测属性的行为，并在需要时提供灵活的 APPEND 功能。尽管属性特定的设置器在某些情况下更为方便，例如允许一次设置多个属性，但它们缺乏 APPEND 功能可能会导致一些项目选择仅使用 ```set_property()```。使用属性特定命令替换属性值而不是附加到属性值上是一个常见的错误。

对于目标属性，强烈建议使用各种 ```target_…()``` 命令而不是直接操作关联的目标属性。这些命令不仅操作特定目标的属性，还设置目标之间的依赖关系，以便 CMake 可以自动传播一些属性。

源属性提供了对编译器选项等级别的细粒度控制。然而，这些属性可能会对项目的构建行为产生不良影响。特别是，当仅有少数源文件的编译选项发生更改时，一些 CMake 生成器可能会重建比必要更多的内容。Xcode 生成器还有限制，无法支持特定于配置的源文件属性。
